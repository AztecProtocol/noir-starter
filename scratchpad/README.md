# Noir with Foundry

This example uses Foundry to deploy and test a verifier.

## Getting Started

### Install nargo

Follow the [Noir Docs](https://noir-lang.org/getting_started/nargo_installation) to install nargo. For this template, ensure you're on UltraPlonk versions (at least 0.5.0).

### Install foundryup

run

```bash
curl -L https://foundry.paradigm.xyz | bash
```

and follow the instructions on screen. You should then have all the foundry tools like `forge`, `cast`, `anvil` and `chisel`.

### Generate verifier contract and proof

#### Contract

The deployment assumes a verifier contract has been generated by nargo. In order to do this, run:

```bash
cd circuits
nargo codegen-verifier
```

A file named `plonk_vk.sol` should appear in the `circuits` folder.

#### Proof

You also need a proof, as this template currently doesn't employ `ffi` to call `nargo prove` by itself. For this, ensure your prover parameters are correct in `Prover.toml` and run:

```bash
nargo prove p
```

A file named `p.proof` should appear in the `proofs` folder.

### Test with Foundry

We're ready to test with Foundry. There's a basic test inside the `test` folder that deploys the verifier contract, the `Starter` contract and two bytes32 arrays correspondent to good and bad solutions to your circuit.

By running the following command, forge will compile the contract with 5000 rounds of optimization and the London EVM version. __You need to use these optimizer settings to supress the "stack too deep" error on the solc compiler__. Then it will run the test, expecting it to pass with correct inputs, and fail with wrong inputs:

```bash
forge test --optimize --optimizer-runs 5000 --evm-version london
```

### Deploy with Foundry

This template also has a script to help you deploy on your own network. But for that you need to run your own node or, alternatively, deploy on a testnet.

#### (Option 1) Run a local node

If you want to deploy locally, run a node by opening a terminal and running

```bash
anvil
```

This should start a local node listening on `http://localhost:8545`. It will also give you many private keys.

Edit your `.env` file to look like:

```
ANVIL_RPC=http://localhost:8545
PRIVATE_KEY=<the private key you just got from anvil>
```

#### (Option 2) Prepare for testnet

Pick a testnet like Sepoia or Goerli. Generate a private key and use a faucet (like [this one for Sepoia](https://sepoliafaucet.com/)) to get some coins in there.

Edit your `.env` file to look like:

```env
SEPOIA_RPC=https://rpc2.sepolia.org
PRIVATE_KEY=<the private key of the account with your coins>
```

#### Run the deploy script

You need to source your `.env` file before deploying. Do that with:

```bash
source .env
```

Then run the deployment with:

```bash
forge script script/Starter.s.sol --rpc-url $ANVIL_RPC --broadcast --verify
```

Replace `$ANVIL_RPC` with the testnet RPC, if you're deploying on a testnet.

## Developing on this template

This template doesn't include settings you may need to deal with syntax highlighting and IDE-specific settings (i.e. VScode). Please follow the instructions on the [Foundy book](https://book.getfoundry.sh/config/vscode) to set that up.

It's __highly recommended__ you get familiar with [Foundry](https://book.getfoundry.sh) before developing on this template.
